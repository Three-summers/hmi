/* ═══════════════════════════════════════════════════════════════════════════
   HMI 全局样式 - 工业未来主义
   ═══════════════════════════════════════════════════════════════════════════ */

/* ═══ 动效：减少动效（系统偏好） ═══ */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation: none !important;
        transition: none !important;
    }
}

/* ═══ 全局重置与基础样式 ═══ */
*,
*::before,
*::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html,
body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    font-family: var(--font-family);
    font-size: var(--font-size-normal);
    font-weight: var(--font-weight-normal);
    background-color: var(--bg-primary);
    color: var(--text-primary);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    /* 禁止文本选择：HMI 面板避免误触选中 */
    user-select: none;
    -webkit-user-select: none;
    /* 禁用触摸呼出菜单（iOS） */
    -webkit-touch-callout: none;
    /* 主题切换：平滑过渡 */
    transition:
        background-color var(--transition-slow),
        color var(--transition-slow);
}

/* ═══ 背景：工业网格纹理 + 噪点磨砂 ═══ */
body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    /* 网格 */
    background-image:
        linear-gradient(var(--border-subtle) 1px, transparent 1px),
        linear-gradient(90deg, var(--border-subtle) 1px, transparent 1px);
    background-size: var(--bg-grid-size) var(--bg-grid-size);
    /* 噪点叠加（模拟磨砂金属） */
    mask-image: linear-gradient(to bottom, rgba(0,0,0,1), rgba(0,0,0,0.8));
    pointer-events: none;
    z-index: 0; /* 背景层：保持在 #root 之下 */
    opacity: var(--bg-overlay-opacity);
}

/* ═══ 背景：暗角（Vignette）增强 ═══ */
body::after {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(
        circle at center,
        transparent 30%,
        var(--vignette-color) 80%,
        var(--bg-primary) 120%
    );
    pointer-events: none;
    z-index: 0; /* 背景层：保持在 #root 之下 */
    opacity: var(--vignette-opacity);
}

/* ═══ 应用根节点 ═══ */
#root {
    position: relative;
    width: 100%;
    height: 100%;
    z-index: 1;
}

/* ═══ 排版增强 ═══ */

/* 显示标题：使用 display 字体（强调“工业仪表”气质） */
h1,
h2,
h3,
.display-text {
    font-family: var(--font-display);
    font-weight: var(--font-weight-bold);
    letter-spacing: 0.05em;
    text-transform: uppercase;
}

/* 数据/数值：使用等宽字体，提升可读性 */
.mono,
code,
pre,
[data-type="value"],
[data-type="number"] {
    font-family: var(--font-mono);
    font-variant-numeric: tabular-nums;
}

/* ═══ 按钮基础样式 ═══ */

button {
    font-family: inherit;
    font-size: inherit;
    font-weight: var(--font-weight-medium);
    border: none;
    background: none;
    cursor: pointer;
    outline: none;
    -webkit-tap-highlight-color: transparent;
    transition: all var(--transition-fast);
}

button:focus-visible {
    outline: var(--border-width-2) solid var(--accent-primary);
    outline-offset: calc(var(--space-1) / 2);
}

/* 触屏友好：避免点击后默认行为干扰 */
button,
[role="button"],
input,
select,
textarea {
    touch-action: manipulation;
}

/* ═══ 滚动条（工业风） ═══ */

::-webkit-scrollbar {
    width: calc(var(--space-2) + calc(var(--space-1) / 2));
    height: calc(var(--space-2) + calc(var(--space-1) / 2));
}

::-webkit-scrollbar-track {
    background: var(--bg-secondary);
    border-left: var(--border-width-1) solid var(--border-subtle);
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(
        180deg,
        var(--button-bg-hover) 0%,
        var(--button-bg) 100%
    );
    border: var(--border-width-1) solid var(--border-color);
    border-radius: var(--radius-xs);
    transition: background var(--transition-fast);
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(
        180deg,
        var(--accent-primary) 0%,
        var(--accent-secondary) 100%
    );
    border-color: var(--accent-primary);
}

::-webkit-scrollbar-corner {
    background: var(--bg-secondary);
}

/* ═══ Firefox：滚动条 ═══ */
* {
    scrollbar-width: thin;
    scrollbar-color: var(--button-bg) var(--bg-secondary);
}

/* ═══ 选中高亮（selection） ═══ */

::selection {
    background: var(--accent-primary);
    color: var(--text-on-accent);
}

/* ═══ 焦点样式（可访问性） ═══ */

:focus {
    outline: none;
}

:focus-visible {
    outline: var(--border-width-2) solid var(--accent-primary);
    outline-offset: calc(var(--space-1) / 2);
    border-radius: var(--radius-xs);
}

/* ═══ 工具类 ═══ */

.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* ═══ 工具类：玻璃卡片 ═══ */
.glass-card {
    background: var(--glass-bg);
    backdrop-filter: blur(var(--blur-md));
    -webkit-backdrop-filter: blur(var(--blur-md));
    border: var(--border-width-1) solid var(--glass-border);
    border-radius: var(--button-radius-lg);
    box-shadow: var(--shadow-md);
}

.glass-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--glass-shine);
    border-radius: inherit;
    pointer-events: none;
}

/* ═══ 工具类：状态高亮（SEMI E95） ═══ */

.highlight-alarm {
    box-shadow: var(--highlight-alarm) !important;
}

.highlight-warning {
    box-shadow: var(--highlight-warning) !important;
}

.highlight-processing {
    box-shadow: var(--highlight-processing) !important;
}

.highlight-attention {
    box-shadow: var(--highlight-attention) !important;
}

/* ═══ 动画关键帧（全局可复用） ═══ */
@keyframes fade-in {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes scale-in {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* ═══ 加载态（Skeleton） ═══ */

.skeleton {
    background: linear-gradient(
        90deg,
        var(--bg-secondary) 25%,
        var(--bg-tertiary) 50%,
        var(--bg-secondary) 75%
    );
    border-radius: var(--radius-xs);
}

/* ═══ Tooltip 提示框 ═══ */

[data-tooltip] {
    position: relative;
}

[data-tooltip]::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%) translateY(calc(var(--space-2) * -1));
    padding: var(--space-2) var(--space-3);
    background: var(--bg-elevated);
    border: var(--border-width-1) solid var(--border-color);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-small);
    color: var(--text-primary);
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-fast);
    z-index: 1000;
    box-shadow: var(--shadow-md);
}

[data-tooltip]:hover::after {
    opacity: 1;
    visibility: visible;
}

/* ═══ 表单控件（input/select/textarea） ═══ */

input,
select,
textarea {
    font-family: var(--font-family);
    font-size: var(--font-size-normal);
    color: var(--text-primary);
    background: var(--button-bg);
    border: var(--border-width-1) solid var(--border-color);
    border-radius: var(--button-radius);
    padding: var(--input-padding-y) var(--input-padding-x);
    transition: all var(--transition-fast);
}

input:hover,
select:hover,
textarea:hover {
    border-color: var(--accent-primary);
}

input:focus,
select:focus,
textarea:focus {
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 3px var(--border-glow);
    outline: none;
}

input::placeholder,
textarea::placeholder {
    color: var(--text-disabled);
}

/* 数字输入：使用等宽字体，便于对齐阅读 */
input[type="number"] {
    font-family: var(--font-mono);
}

/* ═══ 表格样式 ═══ */

table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--font-size-normal);
}

th {
    font-family: var(--font-display);
    font-weight: var(--font-weight-medium);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: var(--font-size-small);
    color: var(--text-secondary);
    background: var(--overlay-weak);
    padding: var(--space-3) var(--space-4);
    text-align: left;
    border-bottom: var(--border-width-2) solid var(--border-color);
}

td {
    padding: var(--space-3) var(--space-4);
    border-bottom: var(--border-width-1) solid var(--border-subtle);
    transition: background var(--transition-fast);
}

tr:hover td {
    background: var(--overlay-weak);
}

/* 数值单元格：右对齐 + 等宽字体 */
td[data-type="number"] {
    font-family: var(--font-mono);
    text-align: right;
}

/* ═══ 徽标（Badge） ═══ */

.badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: var(--badge-min-width);
    height: var(--badge-height);
    padding: 0 var(--badge-padding-x);
    font-family: var(--font-mono);
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-bold);
    border-radius: var(--badge-radius);
    background: var(--accent-primary);
    color: var(--text-on-accent);
    box-shadow: 0 calc(var(--space-1) / 2) var(--space-2)
        var(--color-processing-glow);
}

.badge[data-status="alarm"] {
    background: var(--color-alarm);
    color: var(--text-on-alarm);
    box-shadow: 0 calc(var(--space-1) / 2) var(--space-2)
        var(--color-alarm-glow);
}

.badge[data-status="warning"] {
    background: var(--color-warning);
    color: var(--text-on-warning);
    box-shadow: 0 calc(var(--space-1) / 2) var(--space-2)
        var(--color-warning-glow);
}

.badge[data-status="attention"] {
    background: var(--color-attention);
    box-shadow: 0 calc(var(--space-1) / 2) var(--space-2)
        var(--color-attention-glow);
}

/* ═══ 进度条（Progress） ═══ */

.progress-bar {
    width: 100%;
    height: var(--space-2);
    background: var(--bg-secondary);
    border-radius: var(--radius-xs);
    overflow: hidden;
    border: var(--border-width-1) solid var(--border-subtle);
}

.progress-bar-fill {
    height: 100%;
    background: linear-gradient(
        90deg,
        var(--accent-primary),
        var(--accent-secondary)
    );
    border-radius: var(--radius-xs);
    transition: width var(--transition-normal);
    position: relative;
}

/* ═══ 响应式调整（设计变量） ═══ */

@media (max-width: 1200px) {
    :root {
        --command-panel-width: 10rem; /* 160px @ 16px 基准 */
    }
}

@media (max-width: 900px) {
    :root {
        --title-panel-height: 6.5rem; /* 104px @ 16px 基准 */
        --nav-panel-height: 4.375rem; /* 70px @ 16px 基准 */
        --command-panel-width: 8.75rem; /* 140px @ 16px 基准 */
        --button-min-size: 3.75rem; /* 60px @ 16px 基准 */
    }
}

/* ═══ 高对比主题增强 ═══ */

[data-theme="high-contrast"] {
    /* 网格更明显：在强光环境仍可辨识 */
    body::before {
        opacity: 0.15;
    }

    /* 焦点更明显：适配远距离观看 */
    :focus-visible {
        outline: calc(var(--border-width-1) + var(--border-width-2)) solid
            var(--accent-primary);
        outline-offset: calc(var(--space-1) / 2 + var(--border-width-1));
    }

    /* 滚动条更“硬朗”：边框加粗 */
    ::-webkit-scrollbar-thumb {
        border: var(--border-width-2) solid var(--border-color);
    }
}

/* ═══ 浅色主题微调 ═══ */

[data-theme="light"] {
    /* 浅色主题：网格更轻 */
    body::before {
        opacity: 0.15;
    }

    /* 浅色主题：关闭暗角 */
    body::after {
        opacity: 0;
    }

    /* 浅色主题：滚动条色阶调整 */
    ::-webkit-scrollbar-thumb {
        background: linear-gradient(
            180deg,
            var(--bg-tertiary) 0%,
            var(--text-disabled) 100%
        );
        border-color: var(--border-subtle);
    }

    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(
            180deg,
            var(--accent-primary),
            var(--accent-secondary)
        );
    }
}

/* ═══ 打印样式 ═══ */

@media print {
    body::before,
    body::after {
        display: none;
    }

    * {
        background: white !important;
        color: black !important;
        box-shadow: none !important;
    }
}
